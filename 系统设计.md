# VisionCraft - ä½ä»£ç å¤§å±å¯è§†åŒ–å¹³å°

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              VisionCraft Editor                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç»„ä»¶é¢æ¿    â”‚           ç”»å¸ƒç¼–è¾‘åŒº               â”‚       å±æ€§é…ç½®é¢æ¿        â”‚
â”‚  Component   â”‚         Canvas Editor             â”‚    Property Panel        â”‚
â”‚    Panel     â”‚                                   â”‚                          â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  ğŸ“¦ åŸºç¡€ç»„ä»¶  â”‚  â”‚     Viewport Container      â”‚  â”‚  â”‚   æ ·å¼é…ç½®         â”‚  â”‚
â”‚  â”œâ”€ æ–‡æœ¬     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚   â”œâ”€ ä½ç½®/å°ºå¯¸     â”‚  â”‚
â”‚  â”œâ”€ å›¾ç‰‡     â”‚  â”‚  â”‚    Layout Container   â”‚  â”‚  â”‚  â”‚   â”œâ”€ è¾¹æ¡†/é˜´å½±     â”‚  â”‚
â”‚  â”œâ”€ æŒ‰é’®     â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”‚  â”‚   â””â”€ èƒŒæ™¯/é€æ˜åº¦   â”‚  â”‚
â”‚  â””â”€ å½¢çŠ¶     â”‚  â”‚  â”‚  â”‚ç»„ä»¶â”‚  â”‚ åµŒå¥—å¸ƒå±€ â”‚   â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚              â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚  â”‚   æ•°æ®é…ç½®         â”‚  â”‚
â”‚  ğŸ“Š å›¾è¡¨ç»„ä»¶  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚   â”œâ”€ é™æ€æ•°æ®      â”‚  â”‚
â”‚  â”œâ”€ æŸ±çŠ¶å›¾   â”‚  â”‚                              â”‚  â”‚  â”‚   â””â”€ APIæ•°æ®æº    â”‚  â”‚
â”‚  â”œâ”€ æŠ˜çº¿å›¾   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”œâ”€ é¥¼å›¾     â”‚  â”‚  â”‚   Moveable Controls   â”‚  â”‚  â”‚  â”‚   äº¤äº’é…ç½®         â”‚  â”‚
â”‚  â”œâ”€ ä»ªè¡¨ç›˜   â”‚  â”‚  â”‚   (æ‹–æ‹½/ç¼©æ”¾/æ—‹è½¬)     â”‚  â”‚  â”‚  â”‚   â””â”€ äº‹ä»¶ç»‘å®š      â”‚  â”‚
â”‚  â””â”€ åœ°å›¾     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚  ğŸ”² å¸ƒå±€ç»„ä»¶  â”‚                                   â”‚                          â”‚
â”‚  â”œâ”€ Flexå®¹å™¨ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚  â”œâ”€ Gridå®¹å™¨ â”‚  â”‚     Toolbar (å·¥å…·æ )         â”‚  â”‚                          â”‚
â”‚  â””â”€ è‡ªç”±å®¹å™¨ â”‚  â”‚  æ’¤é”€ é‡åš é¢„è§ˆ å¯¼å‡º ä¿å­˜     â”‚  â”‚                          â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æŠ€æœ¯é€‰å‹

| æ¨¡å— | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
|------|----------|------|----------|
| **æ„å»ºå·¥å…·** | Vite | ^5.x | æé€ŸHMRï¼Œç°ä»£åŒ–æ„å»º |
| **å‰ç«¯æ¡†æ¶** | React | ^18.x | ç”Ÿæ€æˆç†Ÿï¼ŒHooksæ¨¡å¼ |
| **ç±»å‹ç³»ç»Ÿ** | TypeScript | ^5.x | ç±»å‹å®‰å…¨ï¼ŒIDEå‹å¥½ |
| **çŠ¶æ€ç®¡ç†** | Zustand | ^4.x | è½»é‡ã€æ”¯æŒä¸­é—´ä»¶ã€DevTools |
| **æ‹–æ‹½æ ¸å¿ƒ** | @dnd-kit | ^6.x | ç°ä»£åŒ–æ‹–æ‹½åº“ï¼Œæ”¯æŒåµŒå¥— |
| **å˜æ¢æ§åˆ¶** | Moveable | ^0.54.x | ä¸“ä¸šçº§æ‹–æ‹½/ç¼©æ”¾/æ—‹è½¬ |
| **å›¾è¡¨å¼•æ“** | ECharts | ^5.x | å¤§å±æ ‡é…ï¼ŒåŠŸèƒ½å¼ºå¤§ |
| **å±æ€§é¢æ¿** | Formily | ^2.x | Schemaé©±åŠ¨ï¼Œè”åŠ¨å¼ºå¤§ |
| **æ ·å¼æ–¹æ¡ˆ** | TailwindCSS + CSS Modules | ^3.x | åŸå­åŒ– + æ¨¡å—åŒ– |
| **å›¾æ ‡åº“** | Lucide React | latest | è½»é‡ç¾è§‚ |
| **å¯¼å‡ºå›¾ç‰‡** | html-to-image | ^1.x | é«˜ç²¾åº¦æˆªå›¾ |
| **å¯¼å‡ºPDF** | jsPDF | ^2.x | ä¸»æµæ–¹æ¡ˆ |
| **å¿«æ·é”®** | react-hotkeys-hook | ^4.x | å¿«æ·é”®ç»‘å®š |
| **å”¯ä¸€ID** | nanoid | ^5.x | è½»é‡é«˜æ€§èƒ½ |

---

## ä¸‰ã€é¡¹ç›®ç›®å½•ç»“æ„

```
vision-craft/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ preview-runtime.js        # é¢„è§ˆè¿è¡Œæ—¶è„šæœ¬
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                  # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.tsx                   # æ ¹ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # ğŸ¯ æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”œâ”€â”€ schema/               # Schema å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts          # æ ¸å¿ƒç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ component.ts      # ç»„ä»¶Schemaç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ page.ts           # é¡µé¢Schemaç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ validator.ts      # Schemaæ ¡éªŒå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ renderer/             # æ¸²æŸ“å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ SchemaRenderer.tsx    # Schemaæ¸²æŸ“å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ComponentRenderer.tsx # ç»„ä»¶æ¸²æŸ“å™¨
â”‚   â”‚   â”‚   â””â”€â”€ LayoutRenderer.tsx    # å¸ƒå±€æ¸²æŸ“å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dnd/                  # æ‹–æ‹½ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ DndContext.tsx    # æ‹–æ‹½ä¸Šä¸‹æ–‡
â”‚   â”‚   â”‚   â”œâ”€â”€ Draggable.tsx     # å¯æ‹–æ‹½åŒ…è£…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Droppable.tsx     # å¯æ”¾ç½®åŒºåŸŸ
â”‚   â”‚   â”‚   â””â”€â”€ hooks.ts          # æ‹–æ‹½ç›¸å…³Hooks
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ selection/            # é€‰æ‹©ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectionContext.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MoveableWrapper.tsx   # MoveableåŒ…è£…
â”‚   â”‚   â”‚   â””â”€â”€ SelectionBox.tsx      # é€‰æ‹©æ¡†ç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ history/              # å†å²è®°å½•(æ’¤é”€/é‡åš)
â”‚   â”‚       â”œâ”€â”€ useHistory.ts
â”‚   â”‚       â””â”€â”€ historyMiddleware.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                    # ğŸ“¦ çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ index.ts              # Storeå…¥å£
â”‚   â”‚   â”œâ”€â”€ editorStore.ts        # ç¼–è¾‘å™¨çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ componentStore.ts     # ç»„ä»¶çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ selectionStore.ts     # é€‰æ‹©çŠ¶æ€
â”‚   â”‚   â””â”€â”€ historyStore.ts       # å†å²çŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ components/               # ğŸ§© é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/                   # UIåŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â”‚   â”œâ”€â”€ Select/
â”‚   â”‚   â”‚   â”œâ”€â”€ ColorPicker/
â”‚   â”‚   â”‚   â”œâ”€â”€ Slider/
â”‚   â”‚   â”‚   â””â”€â”€ Tooltip/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ editor/               # ç¼–è¾‘å™¨ä¸“ç”¨ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ Toolbar/          # é¡¶éƒ¨å·¥å…·æ 
â”‚   â”‚       â”œâ”€â”€ Sidebar/          # ä¾§è¾¹æ å®¹å™¨
â”‚   â”‚       â”œâ”€â”€ Canvas/           # ç”»å¸ƒç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ ContextMenu/      # å³é”®èœå•
â”‚   â”‚       â””â”€â”€ ZoomControl/      # ç¼©æ”¾æ§åˆ¶
â”‚   â”‚
â”‚   â”œâ”€â”€ materials/                # ğŸ¨ ç‰©æ–™ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ index.ts              # ç‰©æ–™æ³¨å†Œå…¥å£
â”‚   â”‚   â”œâ”€â”€ registry.ts           # ç»„ä»¶æ³¨å†Œå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ basic/                # åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ TextComponent/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx     # ç»„ä»¶å®ç°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts     # å±æ€§Schema
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ thumbnail.svg # ç¼©ç•¥å›¾
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ config.ts     # ç»„ä»¶é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageComponent/
â”‚   â”‚   â”‚   â”œâ”€â”€ ButtonComponent/
â”‚   â”‚   â”‚   â”œâ”€â”€ ShapeComponent/
â”‚   â”‚   â”‚   â””â”€â”€ VideoComponent/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ charts/               # å›¾è¡¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ BarChart/
â”‚   â”‚   â”‚   â”œâ”€â”€ LineChart/
â”‚   â”‚   â”‚   â”œâ”€â”€ PieChart/
â”‚   â”‚   â”‚   â”œâ”€â”€ RadarChart/
â”‚   â”‚   â”‚   â”œâ”€â”€ GaugeChart/
â”‚   â”‚   â”‚   â”œâ”€â”€ ScatterChart/
â”‚   â”‚   â”‚   â””â”€â”€ MapChart/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout/               # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ FlexContainer/    # Flexå¸ƒå±€å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ GridContainer/    # Gridå¸ƒå±€å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ FreeContainer/    # è‡ªç”±å¸ƒå±€å®¹å™¨
â”‚   â”‚   â”‚   â””â”€â”€ TabContainer/     # Tabå®¹å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ decorations/          # è£…é¥°ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ BorderDecor/      # è¾¹æ¡†è£…é¥°
â”‚   â”‚       â”œâ”€â”€ TitleDecor/       # æ ‡é¢˜è£…é¥°
â”‚   â”‚       â””â”€â”€ BackgroundDecor/  # èƒŒæ™¯è£…é¥°
â”‚   â”‚
â”‚   â”œâ”€â”€ panels/                   # ğŸ“‹ é¢æ¿æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ ComponentPanel/       # å·¦ä¾§ç»„ä»¶é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ComponentList.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ComponentCard.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ LayerPanel/           # å›¾å±‚é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ LayerTree.tsx
â”‚   â”‚   â”‚   â””â”€â”€ LayerItem.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ PropertyPanel/        # å³ä¾§å±æ€§é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StylePanel.tsx    # æ ·å¼é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ DataPanel.tsx     # æ•°æ®é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ EventPanel.tsx    # äº‹ä»¶é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ formily/          # Formilyç›¸å…³
â”‚   â”‚   â”‚       â”œâ”€â”€ SchemaField.tsx
â”‚   â”‚   â”‚       â””â”€â”€ widgets/      # è‡ªå®šä¹‰è¡¨å•ç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ DataSourcePanel/      # æ•°æ®æºé¢æ¿
â”‚   â”‚       â”œâ”€â”€ index.tsx
â”‚   â”‚       â””â”€â”€ ApiConfig.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                 # ğŸ”§ åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ export/               # å¯¼å‡ºåŠŸèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ exportImage.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ exportPDF.ts
â”‚   â”‚   â”‚   â””â”€â”€ exportHTML.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ preview/              # é¢„è§ˆåŠŸèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ PreviewModal.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PreviewRenderer.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ shortcuts/            # å¿«æ·é”®
â”‚   â”‚   â”‚   â””â”€â”€ useShortcuts.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ clipboard/            # å‰ªè´´æ¿
â”‚   â”‚       â””â”€â”€ useClipboard.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                    # ğŸª è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ useCanvas.ts
â”‚   â”‚   â”œâ”€â”€ useSelection.ts
â”‚   â”‚   â”œâ”€â”€ useZoom.ts
â”‚   â”‚   â”œâ”€â”€ useAlign.ts
â”‚   â”‚   â””â”€â”€ useGridSnap.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # ğŸ› ï¸ å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ id.ts                 # IDç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ tree.ts               # æ ‘æ“ä½œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ style.ts              # æ ·å¼å¤„ç†
â”‚   â”‚   â””â”€â”€ transform.ts          # å˜æ¢è®¡ç®—
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                   # ğŸ¨ å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ variables.css
â”‚   â”‚   â””â”€â”€ editor.css
â”‚   â”‚
â”‚   â””â”€â”€ types/                    # ğŸ“ ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ component.d.ts
â”‚       â”œâ”€â”€ editor.d.ts
â”‚       â””â”€â”€ global.d.ts
â”‚
â”œâ”€â”€ packages/                     # ğŸ“¦ ç‹¬ç«‹åŒ…
â”‚   â””â”€â”€ runtime/                  # é¢„è§ˆè¿è¡Œæ—¶
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.ts
â”‚       â”‚   â””â”€â”€ RuntimeRenderer.tsx
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

---

## å››ã€æ ¸å¿ƒ Schema è®¾è®¡

### 4.1 ç»„ä»¶ Schema ç±»å‹å®šä¹‰

```typescript
// src/core/schema/types.ts

/** ç»„ä»¶åŸºç¡€ç±»å‹ */
export interface ComponentSchema {
  id: string;                    // å”¯ä¸€æ ‡è¯†
  type: string;                  // ç»„ä»¶ç±»å‹ 'text' | 'image' | 'chart-bar' | 'flex-container'
  name: string;                  // ç»„ä»¶åç§°(å›¾å±‚æ˜¾ç¤º)
  
  // å¸ƒå±€å±æ€§
  layout: LayoutProps;
  
  // æ ·å¼å±æ€§
  style: StyleProps;
  
  // ç»„ä»¶ç‰¹æœ‰å±æ€§
  props: Record<string, any>;
  
  // å­ç»„ä»¶(ä»…å®¹å™¨ç±»å‹æœ‰)
  children?: ComponentSchema[];
  
  // æ•°æ®é…ç½®
  data?: DataConfig;
  
  // äº‹ä»¶é…ç½®
  events?: EventConfig[];
  
  // æ˜¯å¦é”å®š
  locked?: boolean;
  
  // æ˜¯å¦éšè—
  hidden?: boolean;
}

/** å¸ƒå±€å±æ€§ */
export interface LayoutProps {
  // å®šä½æ¨¡å¼: absolute(è‡ªç”±å¸ƒå±€) | relative(æµå¼å¸ƒå±€)
  position: 'absolute' | 'relative';
  
  // è‡ªç”±å¸ƒå±€æ—¶çš„ä½ç½®
  x?: number;
  y?: number;
  
  // å°ºå¯¸
  width: number | 'auto' | string;  // æ”¯æŒç™¾åˆ†æ¯” '50%'
  height: number | 'auto' | string;
  
  // æ—‹è½¬è§’åº¦
  rotation?: number;
  
  // å±‚çº§
  zIndex?: number;
}

/** æ ·å¼å±æ€§ */
export interface StyleProps {
  // èƒŒæ™¯
  background?: {
    type: 'color' | 'gradient' | 'image';
    value: string;
  };
  
  // è¾¹æ¡†
  border?: {
    width: number;
    style: 'solid' | 'dashed' | 'dotted';
    color: string;
    radius: number | number[];  // æ”¯æŒå•å€¼æˆ–å››è§’
  };
  
  // é˜´å½±
  shadow?: {
    x: number;
    y: number;
    blur: number;
    spread: number;
    color: string;
  };
  
  // é€æ˜åº¦
  opacity?: number;
  
  // å†…è¾¹è·
  padding?: number | number[];
  
  // æ»¤é•œ
  filter?: {
    blur?: number;
    brightness?: number;
    contrast?: number;
    saturate?: number;
  };
}

/** æ•°æ®é…ç½® */
export interface DataConfig {
  type: 'static' | 'api' | 'variable';
  
  // é™æ€æ•°æ®
  static?: any;
  
  // APIé…ç½®
  api?: {
    url: string;
    method: 'GET' | 'POST';
    headers?: Record<string, string>;
    params?: Record<string, any>;
    dataPath?: string;          // æ•°æ®è·¯å¾„ å¦‚ 'data.list'
    refreshInterval?: number;   // åˆ·æ–°é—´éš”(ms)
  };
  
  // å˜é‡ç»‘å®š
  variable?: string;
}

/** äº‹ä»¶é…ç½® */
export interface EventConfig {
  trigger: 'click' | 'hover' | 'load';
  action: 'navigate' | 'openModal' | 'setVariable' | 'callApi';
  payload: Record<string, any>;
}

/** é¡µé¢ Schema */
export interface PageSchema {
  id: string;
  name: string;
  
  // ç”»å¸ƒé…ç½®
  canvas: {
    width: number;              // è®¾è®¡å®½åº¦
    height: number;             // è®¾è®¡é«˜åº¦
    background: StyleProps['background'];
    scale: 'fit' | 'fill' | 'none';  // é€‚é…æ¨¡å¼
  };
  
  // ç»„ä»¶æ ‘
  components: ComponentSchema[];
  
  // å…¨å±€å˜é‡
  variables?: Record<string, any>;
  
  // å…¨å±€æ ·å¼
  globalStyles?: string;
}
```

### 4.2 Schema ç¤ºä¾‹

```json
{
  "id": "page_001",
  "name": "æ•°æ®å¤§å±",
  "canvas": {
    "width": 1920,
    "height": 1080,
    "background": {
      "type": "gradient",
      "value": "linear-gradient(180deg, #0a1628 0%, #1a2a4a 100%)"
    },
    "scale": "fit"
  },
  "components": [
    {
      "id": "comp_title",
      "type": "text",
      "name": "ä¸»æ ‡é¢˜",
      "layout": {
        "position": "absolute",
        "x": 760,
        "y": 20,
        "width": 400,
        "height": 60
      },
      "style": {
        "opacity": 1
      },
      "props": {
        "content": "æ™ºæ…§åŸå¸‚æ•°æ®å¤§å±",
        "fontSize": 36,
        "fontWeight": "bold",
        "color": "#00d4ff",
        "textAlign": "center"
      }
    },
    {
      "id": "comp_container_left",
      "type": "flex-container",
      "name": "å·¦ä¾§åŒºåŸŸ",
      "layout": {
        "position": "absolute",
        "x": 20,
        "y": 100,
        "width": 460,
        "height": 960
      },
      "props": {
        "direction": "column",
        "gap": 20
      },
      "children": [
        {
          "id": "comp_chart_bar",
          "type": "chart-bar",
          "name": "é”€å”®æŸ±çŠ¶å›¾",
          "layout": {
            "position": "relative",
            "width": "100%",
            "height": 300
          },
          "props": {
            "title": "æœˆåº¦é”€å”®é¢",
            "xAxisField": "month",
            "yAxisField": "value"
          },
          "data": {
            "type": "static",
            "static": [
              { "month": "1æœˆ", "value": 320 },
              { "month": "2æœˆ", "value": 280 },
              { "month": "3æœˆ", "value": 450 }
            ]
          }
        }
      ]
    }
  ]
}
```

---

## äº”ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 5.1 ç»„ä»¶æ³¨å†Œç³»ç»Ÿ

```typescript
// src/materials/registry.ts

import { ComponentSchema } from '@/core/schema/types';
import { FC } from 'react';
import { ISchema } from '@formily/react';

/** ç‰©æ–™ç»„ä»¶å®šä¹‰ */
export interface MaterialDefinition {
  // åŸºç¡€ä¿¡æ¯
  type: string;                     // ç»„ä»¶ç±»å‹æ ‡è¯†
  name: string;                     // ç»„ä»¶åç§°
  icon: string;                     // å›¾æ ‡
  category: 'basic' | 'chart' | 'layout' | 'decoration';
  
  // ç»„ä»¶å®ç°
  component: FC<any>;               // æ¸²æŸ“ç»„ä»¶
  
  // é»˜è®¤é…ç½®
  defaultSchema: Partial<ComponentSchema>;
  
  // å±æ€§é¢æ¿ Schema (Formily)
  propertySchema: ISchema;
  
  // ç¼©ç•¥å›¾(æ‹–æ‹½æ—¶æ˜¾ç¤º)
  thumbnail?: string;
  
  // æ˜¯å¦ä¸ºå®¹å™¨
  isContainer?: boolean;
  
  // å…è®¸æ”¾ç½®çš„å­ç»„ä»¶ç±»å‹
  allowChildren?: string[] | '*';
  
  // å°ºå¯¸è°ƒæ•´æ¨¡å¼
  resizeMode?: 'both' | 'horizontal' | 'vertical' | 'none';
}

/** ç»„ä»¶æ³¨å†Œå™¨ */
class ComponentRegistry {
  private materials = new Map<string, MaterialDefinition>();
  
  /** æ³¨å†Œç»„ä»¶ */
  register(definition: MaterialDefinition) {
    this.materials.set(definition.type, definition);
  }
  
  /** æ‰¹é‡æ³¨å†Œ */
  registerAll(definitions: MaterialDefinition[]) {
    definitions.forEach(def => this.register(def));
  }
  
  /** è·å–ç»„ä»¶å®šä¹‰ */
  get(type: string): MaterialDefinition | undefined {
    return this.materials.get(type);
  }
  
  /** è·å–æ‰€æœ‰ç»„ä»¶ */
  getAll(): MaterialDefinition[] {
    return Array.from(this.materials.values());
  }
  
  /** æŒ‰åˆ†ç±»è·å– */
  getByCategory(category: string): MaterialDefinition[] {
    return this.getAll().filter(m => m.category === category);
  }
}

export const registry = new ComponentRegistry();
```

### 5.2 çŠ¶æ€ç®¡ç†è®¾è®¡

```typescript
// src/store/editorStore.ts

import { create } from 'zustand';
import { immer } from 'zustand/middleware/immer';
import { devtools, subscribeWithSelector } from 'zustand/middleware';
import { PageSchema, ComponentSchema } from '@/core/schema/types';
import { nanoid } from 'nanoid';

interface EditorState {
  // é¡µé¢æ•°æ®
  page: PageSchema;
  
  // é€‰ä¸­çš„ç»„ä»¶IDåˆ—è¡¨
  selectedIds: string[];
  
  // æ‚¬æµ®çš„ç»„ä»¶ID
  hoveredId: string | null;
  
  // ç”»å¸ƒç¼©æ”¾æ¯”ä¾‹
  zoom: number;
  
  // ç”»å¸ƒåç§»
  canvasOffset: { x: number; y: number };
  
  // æ˜¯å¦æ˜¾ç¤ºç½‘æ ¼
  showGrid: boolean;
  
  // æ˜¯å¦æ˜¾ç¤ºæ ‡å°º
  showRuler: boolean;
  
  // å¸é™„å¼€å…³
  snapEnabled: boolean;
}

interface EditorActions {
  // ç»„ä»¶æ“ä½œ
  addComponent: (component: ComponentSchema, parentId?: string) => void;
  updateComponent: (id: string, updates: Partial<ComponentSchema>) => void;
  removeComponent: (id: string) => void;
  moveComponent: (id: string, targetParentId: string | null, index: number) => void;
  duplicateComponent: (id: string) => void;
  
  // é€‰æ‹©æ“ä½œ
  selectComponent: (id: string, multi?: boolean) => void;
  clearSelection: () => void;
  selectAll: () => void;
  
  // ç”»å¸ƒæ“ä½œ
  setZoom: (zoom: number) => void;
  setCanvasOffset: (offset: { x: number; y: number }) => void;
  updateCanvas: (updates: Partial<PageSchema['canvas']>) => void;
  
  // æ‰¹é‡æ“ä½œ
  alignComponents: (direction: 'left' | 'center' | 'right' | 'top' | 'middle' | 'bottom') => void;
  distributeComponents: (direction: 'horizontal' | 'vertical') => void;
  groupComponents: () => void;
  ungroupComponents: () => void;
  
  // å±‚çº§æ“ä½œ
  bringToFront: (id: string) => void;
  sendToBack: (id: string) => void;
  bringForward: (id: string) => void;
  sendBackward: (id: string) => void;
  
  // å¯¼å…¥å¯¼å‡º
  importSchema: (schema: PageSchema) => void;
  exportSchema: () => PageSchema;
}

export const useEditorStore = create<EditorState & EditorActions>()(
  devtools(
    subscribeWithSelector(
      immer((set, get) => ({
        // åˆå§‹çŠ¶æ€
        page: createEmptyPage(),
        selectedIds: [],
        hoveredId: null,
        zoom: 1,
        canvasOffset: { x: 0, y: 0 },
        showGrid: true,
        showRuler: true,
        snapEnabled: true,
        
        // Actions å®ç°...
        addComponent: (component, parentId) => {
          set(state => {
            if (parentId) {
              const parent = findComponent(state.page.components, parentId);
              if (parent && parent.children) {
                parent.children.push(component);
              }
            } else {
              state.page.components.push(component);
            }
          });
        },
        
        updateComponent: (id, updates) => {
          set(state => {
            const component = findComponent(state.page.components, id);
            if (component) {
              Object.assign(component, updates);
            }
          });
        },
        
        // ... å…¶ä»– actions
      }))
    )
  )
);
```

### 5.3 æ‹–æ‹½ç³»ç»Ÿè®¾è®¡

```typescript
// src/core/dnd/DndContext.tsx

import {
  DndContext,
  DragOverlay,
  useSensor,
  useSensors,
  PointerSensor,
  DragStartEvent,
  DragEndEvent,
  DragOverEvent,
} from '@dnd-kit/core';
import { useState } from 'react';
import { useEditorStore } from '@/store/editorStore';
import { registry } from '@/materials/registry';
import { createComponent } from '@/utils/component';

export function EditorDndContext({ children }) {
  const [activeId, setActiveId] = useState<string | null>(null);
  const [activeType, setActiveType] = useState<'material' | 'component' | null>(null);
  
  const { addComponent, moveComponent } = useEditorStore();
  
  const sensors = useSensors(
    useSensor(PointerSensor, {
      activationConstraint: {
        distance: 5, // 5px åå¼€å§‹æ‹–æ‹½
      },
    })
  );
  
  const handleDragStart = (event: DragStartEvent) => {
    const { active } = event;
    setActiveId(active.id as string);
    
    // åˆ¤æ–­æ˜¯ä»ç»„ä»¶é¢æ¿æ‹–æ‹½è¿˜æ˜¯ç”»å¸ƒå†…ç§»åŠ¨
    if (active.data.current?.type === 'material') {
      setActiveType('material');
    } else {
      setActiveType('component');
    }
  };
  
  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;
    
    if (!over) {
      setActiveId(null);
      setActiveType(null);
      return;
    }
    
    if (activeType === 'material') {
      // ä»ç»„ä»¶é¢æ¿æ‹–å…¥ç”»å¸ƒ
      const materialType = active.data.current?.materialType;
      const definition = registry.get(materialType);
      
      if (definition) {
        const newComponent = createComponent(definition);
        const targetParentId = over.data.current?.isContainer 
          ? over.id as string 
          : null;
        
        addComponent(newComponent, targetParentId);
      }
    } else {
      // ç”»å¸ƒå†…ç§»åŠ¨ç»„ä»¶
      const componentId = active.id as string;
      const targetParentId = over.data.current?.isContainer 
        ? over.id as string 
        : null;
      const index = over.data.current?.index ?? 0;
      
      moveComponent(componentId, targetParentId, index);
    }
    
    setActiveId(null);
    setActiveType(null);
  };
  
  return (
    <DndContext
      sensors={sensors}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
    >
      {children}
      <DragOverlay>
        {activeId && <DragPreview id={activeId} type={activeType} />}
      </DragOverlay>
    </DndContext>
  );
}
```

### 5.4 Moveable å˜æ¢æ§åˆ¶

```typescript
// src/core/selection/MoveableWrapper.tsx

import Moveable from 'react-moveable';
import { useEditorStore } from '@/store/editorStore';
import { useRef, useEffect } from 'react';

interface MoveableWrapperProps {
  targetRef: React.RefObject<HTMLElement>;
  componentId: string;
}

export function MoveableWrapper({ targetRef, componentId }: MoveableWrapperProps) {
  const moveableRef = useRef<Moveable>(null);
  const { updateComponent, selectedIds, zoom, snapEnabled } = useEditorStore();
  
  const isSelected = selectedIds.includes(componentId);
  
  if (!isSelected || !targetRef.current) {
    return null;
  }
  
  return (
    <Moveable
      ref={moveableRef}
      target={targetRef.current}
      
      // å¯æ‹–åŠ¨
      draggable={true}
      
      // å¯ç¼©æ”¾
      resizable={true}
      
      // å¯æ—‹è½¬
      rotatable={true}
      
      // ä¿æŒæ¯”ä¾‹ (æŒ‰ä½ Shift)
      keepRatio={false}
      
      // ç¼©æ”¾æ¯”ä¾‹
      zoom={1 / zoom}
      
      // å¸é™„
      snappable={snapEnabled}
      snapGuidelines={true}
      elementGuidelines={['.vc-component']}
      
      // æ‹–åŠ¨äº‹ä»¶
      onDrag={({ target, transform, translate }) => {
        target.style.transform = transform;
      }}
      
      onDragEnd={({ target, lastEvent }) => {
        if (lastEvent) {
          updateComponent(componentId, {
            layout: {
              x: lastEvent.translate[0],
              y: lastEvent.translate[1],
            }
          });
        }
      }}
      
      // ç¼©æ”¾äº‹ä»¶
      onResize={({ target, width, height, drag }) => {
        target.style.width = `${width}px`;
        target.style.height = `${height}px`;
        target.style.transform = drag.transform;
      }}
      
      onResizeEnd={({ target, lastEvent }) => {
        if (lastEvent) {
          updateComponent(componentId, {
            layout: {
              width: lastEvent.width,
              height: lastEvent.height,
              x: lastEvent.drag.translate[0],
              y: lastEvent.drag.translate[1],
            }
          });
        }
      }}
      
      // æ—‹è½¬äº‹ä»¶
      onRotate={({ target, transform }) => {
        target.style.transform = transform;
      }}
      
      onRotateEnd={({ target, lastEvent }) => {
        if (lastEvent) {
          updateComponent(componentId, {
            layout: {
              rotation: lastEvent.rotate,
            }
          });
        }
      }}
    />
  );
}
```

### 5.5 å±æ€§é¢æ¿ (Formily)

```typescript
// src/panels/PropertyPanel/index.tsx

import { createForm } from '@formily/core';
import { FormProvider, createSchemaField } from '@formily/react';
import { 
  FormItem, 
  Input, 
  NumberPicker, 
  Select, 
  Switch,
  Space,
} from '@formily/antd-v5';
import { useEditorStore } from '@/store/editorStore';
import { registry } from '@/materials/registry';
import { useMemo, useEffect } from 'react';

// è‡ªå®šä¹‰è¡¨å•ç»„ä»¶
import { ColorPicker } from './widgets/ColorPicker';
import { BackgroundPicker } from './widgets/BackgroundPicker';
import { BorderEditor } from './widgets/BorderEditor';
import { ShadowEditor } from './widgets/ShadowEditor';
import { DataSourceEditor } from './widgets/DataSourceEditor';

const SchemaField = createSchemaField({
  components: {
    FormItem,
    Input,
    NumberPicker,
    Select,
    Switch,
    Space,
    ColorPicker,
    BackgroundPicker,
    BorderEditor,
    ShadowEditor,
    DataSourceEditor,
  },
});

export function PropertyPanel() {
  const { selectedIds, page, updateComponent } = useEditorStore();
  
  // è·å–é€‰ä¸­çš„ç»„ä»¶
  const selectedComponent = useMemo(() => {
    if (selectedIds.length !== 1) return null;
    return findComponent(page.components, selectedIds[0]);
  }, [selectedIds, page.components]);
  
  // è·å–ç»„ä»¶å®šä¹‰
  const materialDef = useMemo(() => {
    if (!selectedComponent) return null;
    return registry.get(selectedComponent.type);
  }, [selectedComponent]);
  
  // åˆ›å»ºè¡¨å•
  const form = useMemo(() => createForm({
    values: selectedComponent || {},
    effects() {
      // ç›‘å¬å€¼å˜åŒ–ï¼Œè‡ªåŠ¨åŒæ­¥åˆ° store
      onFieldValueChange('*', (field) => {
        if (selectedComponent) {
          updateComponent(selectedComponent.id, form.values);
        }
      });
    }
  }), [selectedComponent?.id]);
  
  // åŒæ­¥ç»„ä»¶æ•°æ®åˆ°è¡¨å•
  useEffect(() => {
    if (selectedComponent) {
      form.setValues(selectedComponent);
    }
  }, [selectedComponent, form]);
  
  if (!selectedComponent || !materialDef) {
    return (
      <div className="property-panel-empty">
        <p>è¯·é€‰æ‹©ç»„ä»¶</p>
      </div>
    );
  }
  
  // åˆå¹¶é€šç”¨å±æ€§ Schema å’Œç»„ä»¶ç‰¹æœ‰å±æ€§ Schema
  const fullSchema = {
    type: 'object',
    properties: {
      // é€šç”¨å¸ƒå±€å±æ€§
      layout: {
        type: 'void',
        'x-component': 'FormCollapse',
        'x-component-props': { title: 'å¸ƒå±€' },
        properties: {
          x: { type: 'number', title: 'X', 'x-component': 'NumberPicker' },
          y: { type: 'number', title: 'Y', 'x-component': 'NumberPicker' },
          width: { type: 'number', title: 'å®½åº¦', 'x-component': 'NumberPicker' },
          height: { type: 'number', title: 'é«˜åº¦', 'x-component': 'NumberPicker' },
          rotation: { type: 'number', title: 'æ—‹è½¬', 'x-component': 'NumberPicker' },
        }
      },
      // é€šç”¨æ ·å¼å±æ€§
      style: {
        type: 'void',
        'x-component': 'FormCollapse', 
        'x-component-props': { title: 'æ ·å¼' },
        properties: {
          background: { 'x-component': 'BackgroundPicker' },
          border: { 'x-component': 'BorderEditor' },
          shadow: { 'x-component': 'ShadowEditor' },
          opacity: { type: 'number', 'x-component': 'Slider', 'x-component-props': { max: 1, step: 0.1 } },
        }
      },
      // ç»„ä»¶ç‰¹æœ‰å±æ€§
      props: materialDef.propertySchema,
      // æ•°æ®é…ç½®
      data: {
        type: 'void',
        'x-component': 'FormCollapse',
        'x-component-props': { title: 'æ•°æ®' },
        properties: {
          data: { 'x-component': 'DataSourceEditor' }
        }
      }
    }
  };
  
  return (
    <div className="property-panel">
      <FormProvider form={form}>
        <SchemaField schema={fullSchema} />
      </FormProvider>
    </div>
  );
}
```

---

## å…­ã€å¸ƒå±€å®¹å™¨è®¾è®¡

### 6.1 Flex å¸ƒå±€å®¹å™¨

```typescript
// src/materials/layout/FlexContainer/index.tsx

import { CSSProperties, forwardRef } from 'react';
import { ComponentSchema } from '@/core/schema/types';
import { SchemaRenderer } from '@/core/renderer/SchemaRenderer';
import { useDroppable } from '@dnd-kit/core';
import styles from './style.module.css';

interface FlexContainerProps {
  schema: ComponentSchema;
  isEditing?: boolean;
}

export const FlexContainer = forwardRef<HTMLDivElement, FlexContainerProps>(
  ({ schema, isEditing }, ref) => {
    const { props, children = [], style } = schema;
    
    const { setNodeRef, isOver } = useDroppable({
      id: schema.id,
      data: {
        isContainer: true,
        accepts: '*',
      },
    });
    
    const containerStyle: CSSProperties = {
      display: 'flex',
      flexDirection: props.direction || 'row',
      justifyContent: props.justifyContent || 'flex-start',
      alignItems: props.alignItems || 'stretch',
      flexWrap: props.wrap ? 'wrap' : 'nowrap',
      gap: props.gap || 0,
      padding: style?.padding,
      ...getBackgroundStyle(style?.background),
      ...getBorderStyle(style?.border),
    };
    
    return (
      <div
        ref={(node) => {
          setNodeRef(node);
          if (typeof ref === 'function') ref(node);
          else if (ref) ref.current = node;
        }}
        className={`${styles.flexContainer} ${isOver ? styles.dragOver : ''}`}
        style={containerStyle}
        data-component-id={schema.id}
      >
        {children.length === 0 && isEditing ? (
          <div className={styles.placeholder}>
            æ‹–æ‹½ç»„ä»¶åˆ°æ­¤å¤„
          </div>
        ) : (
          children.map((child) => (
            <SchemaRenderer key={child.id} schema={child} isEditing={isEditing} />
          ))
        )}
      </div>
    );
  }
);

// ç»„ä»¶é…ç½®
export const FlexContainerConfig: MaterialDefinition = {
  type: 'flex-container',
  name: 'Flexå¸ƒå±€',
  icon: 'layout',
  category: 'layout',
  component: FlexContainer,
  isContainer: true,
  allowChildren: '*',
  
  defaultSchema: {
    layout: { position: 'absolute', width: 400, height: 300 },
    props: {
      direction: 'row',
      justifyContent: 'flex-start',
      alignItems: 'stretch',
      gap: 10,
      wrap: false,
    },
    children: [],
  },
  
  propertySchema: {
    type: 'object',
    properties: {
      direction: {
        type: 'string',
        title: 'æ–¹å‘',
        enum: ['row', 'column', 'row-reverse', 'column-reverse'],
        'x-component': 'Select',
      },
      justifyContent: {
        type: 'string',
        title: 'ä¸»è½´å¯¹é½',
        enum: ['flex-start', 'center', 'flex-end', 'space-between', 'space-around', 'space-evenly'],
        'x-component': 'Select',
      },
      alignItems: {
        type: 'string',
        title: 'äº¤å‰è½´å¯¹é½',
        enum: ['flex-start', 'center', 'flex-end', 'stretch', 'baseline'],
        'x-component': 'Select',
      },
      gap: {
        type: 'number',
        title: 'é—´è·',
        'x-component': 'NumberPicker',
      },
      wrap: {
        type: 'boolean',
        title: 'æ¢è¡Œ',
        'x-component': 'Switch',
      },
    },
  },
};
```

---

## ä¸ƒã€å¯¼å‡ºç³»ç»Ÿè®¾è®¡

### 7.1 å¯¼å‡ºå›¾ç‰‡

```typescript
// src/features/export/exportImage.ts

import { toPng, toJpeg, toSvg } from 'html-to-image';

export interface ExportImageOptions {
  format: 'png' | 'jpeg' | 'svg';
  quality?: number;       // jpegè´¨é‡
  pixelRatio?: number;    // åƒç´ æ¯”
  backgroundColor?: string;
}

export async function exportImage(
  element: HTMLElement,
  options: ExportImageOptions = { format: 'png' }
): Promise<string> {
  const { format, quality = 0.95, pixelRatio = 2, backgroundColor } = options;
  
  const exportOptions = {
    quality,
    pixelRatio,
    backgroundColor,
    cacheBust: true,
    // è·³è¿‡ä¸éœ€è¦å¯¼å‡ºçš„å…ƒç´ 
    filter: (node: HTMLElement) => {
      return !node.classList?.contains('vc-no-export');
    },
  };
  
  switch (format) {
    case 'png':
      return await toPng(element, exportOptions);
    case 'jpeg':
      return await toJpeg(element, exportOptions);
    case 'svg':
      return await toSvg(element, exportOptions);
    default:
      throw new Error(`Unsupported format: ${format}`);
  }
}

export function downloadImage(dataUrl: string, filename: string) {
  const link = document.createElement('a');
  link.download = filename;
  link.href = dataUrl;
  link.click();
}
```

### 7.2 å¯¼å‡º HTML

```typescript
// src/features/export/exportHTML.ts

import { PageSchema } from '@/core/schema/types';

export async function exportHTML(schema: PageSchema): Promise<string> {
  const { canvas, components, globalStyles } = schema;
  
  // ç”Ÿæˆç‹¬ç«‹å¯è¿è¡Œçš„ HTML
  const html = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${schema.name}</title>
  
  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  
  <!-- è¿è¡Œæ—¶æ¸²æŸ“å™¨ -->
  <script src="https://cdn.jsdelivr.net/npm/vision-craft-runtime@1.0.0/dist/runtime.umd.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    
    #app {
      width: ${canvas.width}px;
      height: ${canvas.height}px;
      position: relative;
      transform-origin: left top;
      background: ${getBackgroundCSS(canvas.background)};
    }
    
    /* è‡ªé€‚åº”ç¼©æ”¾ */
    .scale-fit #app {
      transform: scale(var(--scale));
    }
    
    ${globalStyles || ''}
  </style>
</head>
<body>
  <div id="app"></div>
  
  <script>
    // Schema æ•°æ®
    const schema = ${JSON.stringify(schema, null, 2)};
    
    // è‡ªé€‚åº”ç¼©æ”¾
    function autoScale() {
      const { width, height, scale } = schema.canvas;
      if (scale === 'none') return;
      
      const scaleX = window.innerWidth / width;
      const scaleY = window.innerHeight / height;
      const scaleValue = scale === 'fit' 
        ? Math.min(scaleX, scaleY)
        : Math.max(scaleX, scaleY);
      
      document.body.classList.add('scale-' + scale);
      document.documentElement.style.setProperty('--scale', scaleValue);
    }
    
    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
      autoScale();
      window.addEventListener('resize', autoScale);
      
      // ä½¿ç”¨è¿è¡Œæ—¶æ¸²æŸ“å™¨
      VisionCraftRuntime.render(schema, document.getElementById('app'));
    });
  </script>
</body>
</html>
  `.trim();
  
  return html;
}

export function downloadHTML(html: string, filename: string) {
  const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.download = filename;
  link.href = url;
  link.click();
  URL.revokeObjectURL(url);
}
```

---

## å…«ã€æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ•°æ®æµæ¶æ„å›¾                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚   ç»„ä»¶é¢æ¿    â”‚     â”‚    ç”»å¸ƒ      â”‚     â”‚   å±æ€§é¢æ¿    â”‚               â”‚
â”‚   â”‚  Component   â”‚â”€â”€â”€â”€â–¶â”‚   Canvas     â”‚â—€â”€â”€â”€â”€â”‚   Property   â”‚               â”‚
â”‚   â”‚    Panel     â”‚æ‹–æ‹½  â”‚              â”‚é€‰æ‹©  â”‚    Panel     â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                               â”‚                     â”‚                       â”‚
â”‚                               â–¼                     â”‚                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                                                 â”‚                     â”‚ â”‚
â”‚   â”‚              Zustand Store (çŠ¶æ€ä¸­å¿ƒ)            â”‚                     â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚  â”‚                                              â”‚                   â”‚ â”‚ â”‚
â”‚   â”‚  â”‚   pageSchema: {                              â–¼                   â”‚ â”‚ â”‚
â”‚   â”‚  â”‚     canvas: { width, height, ... }    â—€â”€â”€ updateComponent()     â”‚ â”‚ â”‚
â”‚   â”‚  â”‚     components: [                                                â”‚ â”‚ â”‚
â”‚   â”‚  â”‚       { id, type, props, children }   â—€â”€â”€ addComponent()        â”‚ â”‚ â”‚
â”‚   â”‚  â”‚     ]                                 â—€â”€â”€ removeComponent()      â”‚ â”‚ â”‚
â”‚   â”‚  â”‚   }                                   â—€â”€â”€ moveComponent()        â”‚ â”‚ â”‚
â”‚   â”‚  â”‚                                                                  â”‚ â”‚ â”‚
â”‚   â”‚  â”‚   selectedIds: []                     â—€â”€â”€ selectComponent()      â”‚ â”‚ â”‚
â”‚   â”‚  â”‚   zoom: 1                             â—€â”€â”€ setZoom()              â”‚ â”‚ â”‚
â”‚   â”‚  â”‚                                                                  â”‚ â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                              â”‚                                        â”‚ â”‚
â”‚   â”‚                              â”‚ History Middleware                     â”‚ â”‚
â”‚   â”‚                              â–¼                                        â”‚ â”‚
â”‚   â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚ â”‚
â”‚   â”‚                    â”‚   History Stack  â”‚                               â”‚ â”‚
â”‚   â”‚                    â”‚  undo() / redo() â”‚                               â”‚ â”‚
â”‚   â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚ â”‚
â”‚   â”‚                                                                       â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â”‚ è®¢é˜…å˜åŒ–                                     â”‚
â”‚                               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                      SchemaRenderer (æ¸²æŸ“å¼•æ“)                         â”‚ â”‚
â”‚   â”‚                                                                       â”‚ â”‚
â”‚   â”‚   schema â”€â”€â–¶ éå† components â”€â”€â–¶ æŸ¥æ‰¾æ³¨å†Œç»„ä»¶ â”€â”€â–¶ æ¸²æŸ“ React ç»„ä»¶       â”‚ â”‚
â”‚   â”‚                                                                       â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€å¿«é€Ÿå¯åŠ¨æŒ‡å—

### 9.1 åˆ›å»ºé¡¹ç›®

```bash
# åˆ›å»º Vite + React + TypeScript é¡¹ç›®
npm create vite@latest vision-craft -- --template react-ts

cd vision-craft

# å®‰è£…æ ¸å¿ƒä¾èµ–
npm install zustand immer nanoid
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
npm install moveable react-moveable
npm install echarts echarts-for-react
npm install @formily/core @formily/react @formily/antd-v5
npm install antd @ant-design/icons
npm install html-to-image jspdf
npm install react-hotkeys-hook
npm install lucide-react
npm install tailwindcss postcss autoprefixer -D

# åˆå§‹åŒ– Tailwind
npx tailwindcss init -p
```

### 9.2 å¼€å‘è·¯çº¿å›¾

```
Phase 1: åŸºç¡€æ¡†æ¶ (Week 1-2)
â”œâ”€â”€ é¡¹ç›®åˆå§‹åŒ–ä¸é…ç½®
â”œâ”€â”€ æ ¸å¿ƒ Schema ç±»å‹å®šä¹‰
â”œâ”€â”€ Zustand Store æ­å»º
â”œâ”€â”€ åŸºç¡€ UI ç»„ä»¶åº“
â””â”€â”€ ç¼–è¾‘å™¨å¸ƒå±€æ¡†æ¶

Phase 2: æ‹–æ‹½ä¸æ¸²æŸ“ (Week 3-4)
â”œâ”€â”€ @dnd-kit æ‹–æ‹½ç³»ç»Ÿ
â”œâ”€â”€ Moveable å˜æ¢æ§åˆ¶
â”œâ”€â”€ Schema æ¸²æŸ“å¼•æ“
â”œâ”€â”€ åŸºç¡€ç»„ä»¶å¼€å‘ (æ–‡æœ¬/å›¾ç‰‡/å½¢çŠ¶)
â””â”€â”€ é€‰æ‹©ä¸å¤šé€‰ç³»ç»Ÿ

Phase 3: å±æ€§é¢æ¿ (Week 5-6)
â”œâ”€â”€ Formily è¡¨å•ç³»ç»Ÿ
â”œâ”€â”€ é€šç”¨å±æ€§é¢æ¿
â”œâ”€â”€ è‡ªå®šä¹‰è¡¨å•ç»„ä»¶
â””â”€â”€ æ•°æ®æºé…ç½®é¢æ¿

Phase 4: å¸ƒå±€ç³»ç»Ÿ (Week 7-8)
â”œâ”€â”€ Flex å®¹å™¨ç»„ä»¶
â”œâ”€â”€ Grid å®¹å™¨ç»„ä»¶
â”œâ”€â”€ è‡ªç”±å¸ƒå±€å®¹å™¨
â”œâ”€â”€ åµŒå¥—æ‹–æ‹½æ”¯æŒ
â””â”€â”€ å¯¹é½ä¸åˆ†å¸ƒåŠŸèƒ½

Phase 5: å›¾è¡¨ç»„ä»¶ (Week 9-10)
â”œâ”€â”€ ECharts å°è£…
â”œâ”€â”€ æŸ±çŠ¶å›¾/æŠ˜çº¿å›¾/é¥¼å›¾
â”œâ”€â”€ ä»ªè¡¨ç›˜/é›·è¾¾å›¾
â”œâ”€â”€ å›¾è¡¨æ•°æ®é…ç½®
â””â”€â”€ å›¾è¡¨ä¸»é¢˜ç³»ç»Ÿ

Phase 6: é«˜çº§åŠŸèƒ½ (Week 11-12)
â”œâ”€â”€ æ’¤é”€/é‡åšç³»ç»Ÿ
â”œâ”€â”€ å¿«æ·é”®ç³»ç»Ÿ
â”œâ”€â”€ å³é”®èœå•
â”œâ”€â”€ å›¾å±‚é¢æ¿
â””â”€â”€ å¤åˆ¶ç²˜è´´

Phase 7: å¯¼å‡ºä¸é¢„è§ˆ (Week 13-14)
â”œâ”€â”€ å›¾ç‰‡å¯¼å‡º
â”œâ”€â”€ PDF å¯¼å‡º
â”œâ”€â”€ HTML å¯¼å‡º
â”œâ”€â”€ é¢„è§ˆè¿è¡Œæ—¶
â””â”€â”€ è‡ªé€‚åº”ç¼©æ”¾

Phase 8: ä¼˜åŒ–ä¸å®Œå–„ (Week 15-16)
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ é”™è¯¯è¾¹ç•Œ
â”œâ”€â”€ å•å…ƒæµ‹è¯•
â”œâ”€â”€ æ–‡æ¡£ç¼–å†™
â””â”€â”€ éƒ¨ç½²ä¸Šçº¿
```

---

## åã€å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| æ‹–æ‹½åº“é€‰æ‹© | @dnd-kit + Moveable | dnd-kit å¤„ç†ç»„ä»¶æ‹–å…¥ï¼ŒMoveable å¤„ç†ç”»å¸ƒå†…å˜æ¢ |
| Schema å­˜å‚¨ | ç»„ä»¶æ ‘ç»“æ„ | å¤©ç„¶æ”¯æŒåµŒå¥—å¸ƒå±€ï¼Œæ˜“äºéå†æ¸²æŸ“ |
| çŠ¶æ€æ›´æ–° | Immer | ä¸å¯å˜æ›´æ–°ï¼Œæ–¹ä¾¿å®ç° undo/redo |
| å±æ€§é¢æ¿ | Formily | Schema é©±åŠ¨ï¼Œè”åŠ¨èƒ½åŠ›å¼ºï¼Œå‡å°‘é‡å¤ä»£ç  |
| ç»„ä»¶å®šä½ | æ··åˆæ¨¡å¼ | æ ¹å®¹å™¨ç”¨ absoluteï¼Œå¸ƒå±€å®¹å™¨å†…ç”¨ relative |
| æ•°æ®æµ | å•å‘æ•°æ®æµ | Store â†’ Renderer â†’ Componentï¼Œæ¸…æ™°å¯è¿½è¸ª |

---

## åä¸€ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **è™šæ‹ŸåŒ–æ¸²æŸ“**: å¤§é‡ç»„ä»¶æ—¶ä½¿ç”¨ react-window è™šæ‹ŸåŒ–å›¾å±‚åˆ—è¡¨
2. **é€‰æ‹©æ€§é‡æ¸²æŸ“**: ä½¿ç”¨ zustand selector åªè®¢é˜…éœ€è¦çš„çŠ¶æ€
3. **é˜²æŠ–æ›´æ–°**: æ‹–æ‹½è¿‡ç¨‹ä¸­é˜²æŠ–æ›´æ–° store
4. **æ‡’åŠ è½½**: å›¾è¡¨ç»„ä»¶æŒ‰éœ€åŠ è½½ ECharts æ¨¡å—
5. **Worker å¯¼å‡º**: å¯¼å‡ºæ“ä½œæ”¾åˆ° Web Worker ä¸­æ‰§è¡Œ
6. **ç¼“å­˜è®¡ç®—**: useMemo ç¼“å­˜æ ·å¼è®¡ç®—ç»“æœ
